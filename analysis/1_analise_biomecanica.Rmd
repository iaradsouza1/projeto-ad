---
title: "1_analise_biomecanica"
author: "iaradsouza1"
date: "2022-07-26"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = F, warning = F)

library(tidyverse)
library(gridExtra)
theme_set(theme_bw())
```

# Centro de Pressão (CoP)

```{r}
# Carregar os dados preprocessados
load("output/biomecanica_processado.RData")

# Obter as médias de cada medição M1 (tandem, semitandem, juntos, separados)
m1 %>% 
  group_by(id, trat) %>% 
  summarise(media_area_cp = mean(area_var)) %>% 
  mutate(momento = "M1") %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() -> m1_df

# Obter as médias de cada medição M2 (tandem, semitandem, juntos, separados)
m2 %>% 
  group_by(id, trat) %>% 
  summarise(media_area_cp = mean(area_var)) %>% 
  mutate(momento = "M2") %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() -> m2_df

df_area_m1 <- m1_df %>% 
  pivot_wider(id_cols = id, names_from = trat, values_from = media_area_cp) %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() %>% 
  mutate(momento = 1)

df_area_m2 <- m2_df %>% 
  pivot_wider(id_cols = id, names_from = trat, values_from = media_area_cp) %>% 
  inner_join(meta_m2 %>% select(id, grupo), by = "id") %>% 
  unique() %>% 
  mutate(momento = 2)

df_area <- bind_rows(df_area_m1, df_area_m2) %>% 
  mutate(momento = as.factor(momento))
```

## Análise exploratória

Distribuição da área do centro de pressão, em cm², por momento. 

```{r}
# Análise estatística -----------------------------------------------------

# MANOVA COM 2 FATORES: TIPO DE INTERVENÇÃO E MOMENTO

# Análise exploratória
g1 <- ggplot(df_area, aes(x = momento, y = juntos, group = momento)) +
  geom_boxplot() + 
  labs(title = "Juntos", x = "Momentos", y = "CoP (cm²)")

g2 <- ggplot(df_area, aes(x = momento, y = semitandem, group = momento)) +
  geom_boxplot() +
  labs(title = "Semitandem", x = "Momentos", y = "CoP (cm²)")

g3 <- ggplot(df_area, aes(x = momento, y = separados, group = momento)) +
  geom_boxplot() +
  labs(title = "Separados", x = "Momentos", y = "CoP (cm²)")

g4 <- ggplot(df_area, aes(x = momento, y = tandem, group = momento)) +
  geom_boxplot() +
  labs(title = "Tandem", x = "Momentos", y = "CoP (cm²)")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

Distribuição da área do centro de pressão, em cm², por grupo de intervenção.

```{r}
g1 <- ggplot(df_area, aes(x = grupo, y = juntos, group = grupo)) +
  geom_boxplot() + 
  labs(title = "Juntos", x = "Grupos", y = "CoP (cm²)")

g2 <- ggplot(df_area, aes(x = grupo, y = semitandem, group = grupo)) +
  geom_boxplot() +
  labs(title = "Semi-tandem", x = "Grupos", y = "CoP (cm²)")

g3 <- ggplot(df_area, aes(x = grupo, y = separados, group = grupo)) +
  geom_boxplot() +
  labs(title = "Separados", x = "Grupos", y = "CoP (cm²)")

g4 <- ggplot(df_area, aes(x = grupo, y = tandem, group = grupo)) +
  geom_boxplot() +
  labs(title = "Tandem", x = "Grupos", y = "CoP (cm²)")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

Interação entre os momentos e os grupos de intervenção:

```{r}
# Interação entre os fatores

g1 <- df_area %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(juntos, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Juntos", x = "Grupos", y = "CoP (cm²)", col = "Momento")

g2 <- df_area %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(semitandem, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Semi-tandem", x = "Grupos", y = "CoP (cm²)", col = "Momento")

g3 <- df_area %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(separados, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Separados", x = "Grupos", y = "CoP (cm²)", col = "Momento")

g4 <- df_area %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(tandem, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Tandem", x = "Grupos", y = "CoP (cm²)", col = "Momento")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```


## MANOVA

ANOVA multivariada (MANOVA) para 2 fatores (momento e grupo de intervenção). Este teste baseia-se na estatística de Wilks. A hipótese nula do teste para a interação entre grupo e momento assume que todas as combinações entre os grupos intervenção e 

```{r}
modelo <- manova(
  cbind(
    log(juntos),
    log(semitandem), 
    log(separados), 
    log(tandem)
  ) ~ grupo*momento, data = df_area)

summary(modelo, test = "Wilks")
```

Abaixo está a análise dos resíduos para o ajuste deste modelo. A análise de resíduos valida o modelo ajustado, uma vez que as premissas de homoscedasticidade e normalidade dos resíduos parecem se confirmar entre os grupos testados. 

```{r}
residuos <- function(modelo){
  
  require(reshape2)
  require(dplyr)
  
  residuos        <- melt(modelo$residuals)
  names(residuos) <- c("id", "resposta", "residuos")
  
  preditos        <- melt(modelo$fitted.values)
  names(preditos) <- c("id", "resposta", "preditos")
  
  diagnostico <- left_join(residuos, preditos, 
                           by = c("id", "resposta"))
  
  return(diagnostico)
}

diagnostico <- residuos(modelo)

ggplot(diagnostico, aes(x = preditos, y = scale(residuos))) +
  geom_point()

ggplot(diagnostico, aes(sample = scale(residuos))) +
  stat_qq() +
  geom_abline()

ggplot(diagnostico, aes(x = preditos, y = scale(residuos))) +
  geom_point() +
  facet_wrap(~ resposta, scales = "free")

ggplot(diagnostico, aes(sample = scale(residuos))) +
  stat_qq() +
  geom_abline() +
  facet_wrap(~ resposta)

ggplot(diagnostico, aes(x = scale(residuos))) +
  geom_histogram() +
  facet_wrap(~ resposta)

# Teste Shapiro de normalidade dos resíduos
tapply(diagnostico$residuos, diagnostico$resposta, shapiro.test)

shapiro.test(log(df_area$juntos))
shapiro.test(log(df_area$semitandem))
shapiro.test(log(df_area$separados))
shapiro.test(log(df_area$tandem))

hist(log(df_area$juntos), 10)
hist(log(df_area$semitandem), 10)
hist(log(df_area$separados), 10)
hist(log(df_area$tandem), 10)
```


https://stats.stackexchange.com/questions/5617/what-is-the-null-hypothesis-for-interaction-in-a-two-way-anova

# Amplitude médio-lateral

```{r}
# Obter as médias de cada medição M1 (tandem, semitandem, juntos, separados)
m1 %>% 
  group_by(id, trat) %>% 
  summarise(media_ampl_ml = mean(ampl_ml)) %>% 
  mutate(momento = "M1") %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() -> m1_df

# Obter as médias de cada medição M2 (tandem, semitandem, juntos, separados)
m2 %>% 
  group_by(id, trat) %>% 
  summarise(media_ampl_ml = mean(ampl_ml)) %>% 
  mutate(momento = "M2") %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() -> m2_df

df_ampl_ml_m1 <- m1_df %>% 
  pivot_wider(id_cols = id, names_from = trat, values_from = media_ampl_ml) %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() %>% 
  mutate(momento = 1)

df_ampl_ml_m2 <- m2_df %>% 
  pivot_wider(id_cols = id, names_from = trat, values_from = media_ampl_ml) %>% 
  inner_join(meta_m2 %>% select(id, grupo), by = "id") %>% 
  unique() %>% 
  mutate(momento = 2)

df_ampl_ml <- bind_rows(df_ampl_ml_m1, df_ampl_ml_m2) %>% 
  mutate(momento = as.factor(momento))

```


## Análise exploratória

Distribuição da área do centro de pressão, em cm², por momento. 

```{r}
# Análise estatística -----------------------------------------------------

# MANOVA COM 2 FATORES: TIPO DE INTERVENÇÃO E MOMENTO

# Análise exploratória
g1 <- ggplot(df_ampl_ml, aes(x = momento, y = juntos, group = momento)) +
  geom_boxplot() + 
  labs(title = "Juntos", x = "Momentos", y = "Amplitude ML")

g2 <- ggplot(df_ampl_ml, aes(x = momento, y = semitandem, group = momento)) +
  geom_boxplot() +
  labs(title = "Semitandem", x = "Momentos", y = "Amplitude ML")

g3 <- ggplot(df_ampl_ml, aes(x = momento, y = separados, group = momento)) +
  geom_boxplot() +
  labs(title = "Separados", x = "Momentos", y = "Amplitude ML")

g4 <- ggplot(df_ampl_ml, aes(x = momento, y = tandem, group = momento)) +
  geom_boxplot() +
  labs(title = "Tandem", x = "Momentos", y = "Amplitude ML")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

Distribuição da amplitude médio-lateral, em XX, por grupo de intervenção.

```{r}
g1 <- ggplot(df_ampl_ml, aes(x = grupo, y = juntos, group = grupo)) +
  geom_boxplot() + 
  labs(title = "Juntos", x = "Grupos", y = "Amplitude ML")

g2 <- ggplot(df_ampl_ml, aes(x = grupo, y = semitandem, group = grupo)) +
  geom_boxplot() +
  labs(title = "Semi-tandem", x = "Grupos", y = "Amplitude ML")

g3 <- ggplot(df_ampl_ml, aes(x = grupo, y = separados, group = grupo)) +
  geom_boxplot() +
  labs(title = "Separados", x = "Grupos", y = "Amplitude ML")

g4 <- ggplot(df_ampl_ml, aes(x = grupo, y = tandem, group = grupo)) +
  geom_boxplot() +
  labs(title = "Tandem", x = "Grupos", y = "Amplitude ML")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

Interação entre os momentos e os grupos de intervenção:

```{r}
# Interação entre os fatores

g1 <- df_ampl_ml %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(juntos, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Juntos", x = "Grupos", y = "Amplitude ML", col = "Momento")

g2 <- df_ampl_ml %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(semitandem, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Semi-tandem", x = "Grupos", y = "Amplitude ML", col = "Momento")

g3 <- df_ampl_ml %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(separados, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Separados", x = "Grupos", y = "Amplitude ML", col = "Momento")

g4 <- df_ampl_ml %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(tandem, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Tandem", x = "Grupos", y = "Amplitude ML", col = "Momento")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

## MANOVA

ANOVA multivariada (MANOVA) para 2 fatores (momento e grupo de intervenção). Este teste baseia-se na estatística de Wilks. A hipótese nula do teste para a interação entre grupo e momento assume que todas as combinações entre os grupos intervenção e 

```{r}
modelo <- manova(
  cbind(
    log(juntos),
    log(semitandem), 
    log(separados), 
    log(tandem)
  ) ~ grupo*momento, data = df_ampl_ml)

summary(modelo, test = "Wilks")
```

Abaixo está a análise dos resíduos para o ajuste deste modelo. A análise de resíduos valida o modelo ajustado, uma vez que as premissas de homoscedasticidade e normalidade dos resíduos parecem se confirmar entre os grupos testados. 

```{r}
residuos <- function(modelo){
  
  require(reshape2)
  require(dplyr)
  
  residuos        <- melt(modelo$residuals)
  names(residuos) <- c("id", "resposta", "residuos")
  
  preditos        <- melt(modelo$fitted.values)
  names(preditos) <- c("id", "resposta", "preditos")
  
  diagnostico <- left_join(residuos, preditos, 
                           by = c("id", "resposta"))
  
  return(diagnostico)
}

diagnostico <- residuos(modelo)

ggplot(diagnostico, aes(x = preditos, y = scale(residuos))) +
  geom_point()

ggplot(diagnostico, aes(sample = scale(residuos))) +
  stat_qq() +
  geom_abline()

ggplot(diagnostico, aes(x = preditos, y = scale(residuos))) +
  geom_point() +
  facet_wrap(~ resposta, scales = "free")

ggplot(diagnostico, aes(sample = scale(residuos))) +
  stat_qq() +
  geom_abline() +
  facet_wrap(~ resposta)

ggplot(diagnostico, aes(x = scale(residuos))) +
  geom_histogram() +
  facet_wrap(~ resposta)

# Teste Shapiro de normalidade dos resíduos
tapply(diagnostico$residuos, diagnostico$resposta, shapiro.test)

shapiro.test(log(df_ampl_ml$juntos))
shapiro.test(log(df_ampl_ml$semitandem))
shapiro.test(log(df_ampl_ml$separados))
shapiro.test(log(df_ampl_ml$tandem))

hist(log(df_ampl_ml$juntos), 10)
hist(log(df_ampl_ml$semitandem), 10)
hist(log(df_ampl_ml$separados), 10)
hist(log(df_ampl_ml$tandem), 10)
```

# Amplitude ântero-posterior

```{r}
# Obter as médias de cada medição M1 (tandem, semitandem, juntos, separados)
m1 %>% 
  group_by(id, trat) %>% 
  summarise(media_ampl_ap = mean(ampl_ap)) %>% 
  mutate(momento = "M1") %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() -> m1_df

# Obter as médias de cada medição M2 (tandem, semitandem, juntos, separados)
m2 %>% 
  group_by(id, trat) %>% 
  summarise(media_ampl_ap = mean(ampl_ap)) %>% 
  mutate(momento = "M2") %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() -> m2_df

df_ampl_ap_m1 <- m1_df %>% 
  pivot_wider(id_cols = id, names_from = trat, values_from = media_ampl_ap) %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() %>% 
  mutate(momento = 1)

df_ampl_ap_m2 <- m2_df %>% 
  pivot_wider(id_cols = id, names_from = trat, values_from = media_ampl_ap) %>% 
  inner_join(meta_m2 %>% select(id, grupo), by = "id") %>% 
  unique() %>% 
  mutate(momento = 2)

df_ampl_ap <- bind_rows(df_ampl_ap_m1, df_ampl_ap_m2) %>% 
  mutate(momento = as.factor(momento))

```


## Análise exploratória

Distribuição da amplitude ântero-posterior, em cm², por momento. 

```{r}
# Análise estatística -----------------------------------------------------

# MANOVA COM 2 FATORES: TIPO DE INTERVENÇÃO E MOMENTO

# Análise exploratória
g1 <- ggplot(df_ampl_ap, aes(x = momento, y = juntos, group = momento)) +
  geom_boxplot() + 
  labs(title = "Juntos", x = "Momentos", y = "Amplitude AP")

g2 <- ggplot(df_ampl_ap, aes(x = momento, y = semitandem, group = momento)) +
  geom_boxplot() +
  labs(title = "Semitandem", x = "Momentos", y = "Amplitude AP")

g3 <- ggplot(df_ampl_ap, aes(x = momento, y = separados, group = momento)) +
  geom_boxplot() +
  labs(title = "Separados", x = "Momentos", y = "Amplitude AP")

g4 <- ggplot(df_ampl_ap, aes(x = momento, y = tandem, group = momento)) +
  geom_boxplot() +
  labs(title = "Tandem", x = "Momentos", y = "Amplitude AP")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

Distribuição da amplitude ântero-posterior, em XX, por grupo de intervenção.

```{r}
g1 <- ggplot(df_ampl_ap, aes(x = grupo, y = juntos, group = grupo)) +
  geom_boxplot() + 
  labs(title = "Juntos", x = "Grupos", y = "Amplitude AP")

g2 <- ggplot(df_ampl_ap, aes(x = grupo, y = semitandem, group = grupo)) +
  geom_boxplot() +
  labs(title = "Semi-tandem", x = "Grupos", y = "Amplitude AP")

g3 <- ggplot(df_ampl_ap, aes(x = grupo, y = separados, group = grupo)) +
  geom_boxplot() +
  labs(title = "Separados", x = "Grupos", y = "Amplitude AP")

g4 <- ggplot(df_ampl_ap, aes(x = grupo, y = tandem, group = grupo)) +
  geom_boxplot() +
  labs(title = "Tandem", x = "Grupos", y = "Amplitude AP")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

Interação entre os momentos e os grupos de intervenção:

```{r}
# Interação entre os fatores

g1 <- df_ampl_ap %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(juntos, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Juntos", x = "Grupos", y = "Amplitude AP", col = "Momento")

g2 <- df_ampl_ap %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(semitandem, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Semi-tandem", x = "Grupos", y = "Amplitude AP", col = "Momento")

g3 <- df_ampl_ap %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(separados, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Separados", x = "Grupos", y = "Amplitude AP", col = "Momento")

g4 <- df_ampl_ap %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(tandem, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Tandem", x = "Grupos", y = "Amplitude AP", col = "Momento")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

## MANOVA

ANOVA multivariada (MANOVA) para 2 fatores (momento e grupo de intervenção). Este teste baseia-se na estatística de Wilks. A hipótese nula do teste para a interação entre grupo e momento assume que todas as combinações entre os grupos intervenção e 

```{r}
modelo <- manova(
  cbind(
    log(juntos),
    log(semitandem), 
    log(separados), 
    log(tandem)
  ) ~ grupo*momento, data = df_ampl_ap)

summary(modelo, test = "Wilks")
```

Abaixo está a análise dos resíduos para o ajuste deste modelo. A análise de resíduos valida o modelo ajustado, uma vez que as premissas de homoscedasticidade e normalidade dos resíduos parecem se confirmar entre os grupos testados. 

```{r}
residuos <- function(modelo){
  
  require(reshape2)
  require(dplyr)
  
  residuos        <- melt(modelo$residuals)
  names(residuos) <- c("id", "resposta", "residuos")
  
  preditos        <- melt(modelo$fitted.values)
  names(preditos) <- c("id", "resposta", "preditos")
  
  diagnostico <- left_join(residuos, preditos, 
                           by = c("id", "resposta"))
  
  return(diagnostico)
}

diagnostico <- residuos(modelo)

ggplot(diagnostico, aes(x = preditos, y = scale(residuos))) +
  geom_point()

ggplot(diagnostico, aes(sample = scale(residuos))) +
  stat_qq() +
  geom_abline()

ggplot(diagnostico, aes(x = preditos, y = scale(residuos))) +
  geom_point() +
  facet_wrap(~ resposta, scales = "free")

ggplot(diagnostico, aes(sample = scale(residuos))) +
  stat_qq() +
  geom_abline() +
  facet_wrap(~ resposta)

ggplot(diagnostico, aes(x = scale(residuos))) +
  geom_histogram() +
  facet_wrap(~ resposta)

# Teste Shapiro de normalidade dos resíduos
tapply(diagnostico$residuos, diagnostico$resposta, shapiro.test)

shapiro.test(log(df_ampl_ap$juntos))
shapiro.test(log(df_ampl_ap$semitandem))
shapiro.test(log(df_ampl_ap$separados))
shapiro.test(log(df_ampl_ap$tandem))

hist(log(df_ampl_ap$juntos), 10)
hist(log(df_ampl_ap$semitandem), 10)
hist(log(df_ampl_ap$separados), 10)
hist(log(df_ampl_ap$tandem), 10)
```


# Velocidade média total

```{r}
# Obter as médias de cada medição M1 (tandem, semitandem, juntos, separados)
m1 %>% 
  group_by(id, trat) %>% 
  summarise(media_vel_media_total = mean(vel_media_total)) %>% 
  mutate(momento = "M1") %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() -> m1_df

# Obter as médias de cada medição M2 (tandem, semitandem, juntos, separados)
m2 %>% 
  group_by(id, trat) %>% 
  summarise(media_vel_media_total = mean(vel_media_total)) %>% 
  mutate(momento = "M2") %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() -> m2_df

df_vel_media_total_m1 <- m1_df %>% 
  pivot_wider(id_cols = id, names_from = trat, values_from = media_vel_media_total) %>% 
  inner_join(meta_m1 %>% select(id, grupo), by = "id") %>% 
  unique() %>% 
  mutate(momento = 1)

df_vel_media_total_m2 <- m2_df %>% 
  pivot_wider(id_cols = id, names_from = trat, values_from = media_vel_media_total) %>% 
  inner_join(meta_m2 %>% select(id, grupo), by = "id") %>% 
  unique() %>% 
  mutate(momento = 2)

df_vel_media_total <- bind_rows(df_vel_media_total_m1, df_vel_media_total_m2) %>% 
  mutate(momento = as.factor(momento))
```


## Análise exploratória

Distribuição da velocidade média total, em XX, por momento. 

```{r}
# Análise estatística -----------------------------------------------------

# MANOVA COM 2 FATORES: TIPO DE INTERVENÇÃO E MOMENTO

# Análise exploratória
g1 <- ggplot(df_vel_media_total, aes(x = momento, y = juntos, group = momento)) +
  geom_boxplot() + 
  labs(title = "Juntos", x = "Momentos", y = "Velocidade média total")

g2 <- ggplot(df_vel_media_total, aes(x = momento, y = semitandem, group = momento)) +
  geom_boxplot() +
  labs(title = "Semitandem", x = "Momentos", y = "Velocidade média total")

g3 <- ggplot(df_vel_media_total, aes(x = momento, y = separados, group = momento)) +
  geom_boxplot() +
  labs(title = "Separados", x = "Momentos", y = "Velocidade média total")

g4 <- ggplot(df_vel_media_total, aes(x = momento, y = tandem, group = momento)) +
  geom_boxplot() +
  labs(title = "Tandem", x = "Momentos", y = "Velocidade média total")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

Distribuição da velocidade média total, em XX, por grupo de intervenção.

```{r}
g1 <- ggplot(df_vel_media_total, aes(x = grupo, y = juntos, group = grupo)) +
  geom_boxplot() + 
  labs(title = "Juntos", x = "Grupos", y = "Velocidade média total")

g2 <- ggplot(df_vel_media_total, aes(x = grupo, y = semitandem, group = grupo)) +
  geom_boxplot() +
  labs(title = "Semi-tandem", x = "Grupos", y = "Velocidade média total")

g3 <- ggplot(df_vel_media_total, aes(x = grupo, y = separados, group = grupo)) +
  geom_boxplot() +
  labs(title = "Separados", x = "Grupos", y = "Velocidade média total")

g4 <- ggplot(df_vel_media_total, aes(x = grupo, y = tandem, group = grupo)) +
  geom_boxplot() +
  labs(title = "Tandem", x = "Grupos", y = "Velocidade média total")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

Interação entre os momentos e os grupos de intervenção:

```{r}
# Interação entre os fatores

g1 <- df_vel_media_total %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(juntos, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Juntos", x = "Grupos", y = "Velocidade média total", col = "Momento")

g2 <- df_vel_media_total %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(semitandem, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Semi-tandem", x = "Grupos", y = "Velocidade média total", col = "Momento")

g3 <- df_vel_media_total %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(separados, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Separados", x = "Grupos", y = "Velocidade média total", col = "Momento")

g4 <- df_vel_media_total %>%
  group_by(grupo, momento) %>%
  summarise(media = mean(tandem, na.rm = T)) %>%
  ggplot(., aes(x = grupo, y = media, colour = momento, group = momento)) +
  geom_line() +
  labs(title = "Tandem", x = "Grupos", y = "Velocidade média total", col = "Momento")

grid.arrange(g1, g2, g3, g4, ncol = 2, nrow = 2)
```

## MANOVA

ANOVA multivariada (MANOVA) para 2 fatores (momento e grupo de intervenção). Este teste baseia-se na estatística de Wilks. A hipótese nula do teste para a interação entre grupo e momento assume que todas as combinações entre os grupos intervenção e 

```{r}
modelo <- manova(
  cbind(
    log(juntos),
    log(semitandem), 
    log(separados), 
    log(tandem)
  ) ~ grupo*momento, data = df_vel_media_total)

summary(modelo, test = "Wilks")
```

Abaixo está a análise dos resíduos para o ajuste deste modelo. A análise de resíduos valida o modelo ajustado, uma vez que as premissas de homoscedasticidade e normalidade dos resíduos parecem se confirmar entre os grupos testados. 

```{r}
residuos <- function(modelo){
  
  require(reshape2)
  require(dplyr)
  
  residuos        <- melt(modelo$residuals)
  names(residuos) <- c("id", "resposta", "residuos")
  
  preditos        <- melt(modelo$fitted.values)
  names(preditos) <- c("id", "resposta", "preditos")
  
  diagnostico <- left_join(residuos, preditos, 
                           by = c("id", "resposta"))
  
  return(diagnostico)
}

diagnostico <- residuos(modelo)

ggplot(diagnostico, aes(x = preditos, y = scale(residuos))) +
  geom_point()

ggplot(diagnostico, aes(sample = scale(residuos))) +
  stat_qq() +
  geom_abline()

ggplot(diagnostico, aes(x = preditos, y = scale(residuos))) +
  geom_point() +
  facet_wrap(~ resposta, scales = "free")

ggplot(diagnostico, aes(sample = scale(residuos))) +
  stat_qq() +
  geom_abline() +
  facet_wrap(~ resposta)

ggplot(diagnostico, aes(x = scale(residuos))) +
  geom_histogram() +
  facet_wrap(~ resposta)

# Teste Shapiro de normalidade dos resíduos
tapply(diagnostico$residuos, diagnostico$resposta, shapiro.test)

shapiro.test(log(df_vel_media_total$juntos))
shapiro.test(log(df_vel_media_total$semitandem))
shapiro.test(log(df_vel_media_total$separados))
shapiro.test(log(df_vel_media_total$tandem))

hist(log(df_vel_media_total$juntos), 10)
hist(log(df_vel_media_total$semitandem), 10)
hist(log(df_vel_media_total$separados), 10)
hist(log(df_vel_media_total$tandem), 10)
```




